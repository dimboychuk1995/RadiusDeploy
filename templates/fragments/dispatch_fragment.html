<div class="container-fluid">
  <h2 class="mb-4">Dispatch Calendars</h2>

  <!-- ✅ Глобальный переключатель недель -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <button class="btn btn-outline-secondary btn-sm" id="globalPrevWeekBtn">← Пред. неделя</button>
    <div class="fw-bold" id="globalWeekLabel"></div>
    <button class="btn btn-outline-secondary btn-sm" id="globalNextWeekBtn">След. неделя →</button>
  </div>

  {% for dispatcher in dispatchers %}
    {% set dispatcher_id = dispatcher._id|string %}

    <div class="dispatch-dispatcher-block mb-5"
         data-drivers='{{ grouped_drivers.get(dispatcher_id, []) | tojson | safe }}'
         data-loads='{{ all_loads | tojson | safe }}'>

      <h5 class="mb-2">Диспетчер: {{ dispatcher.username }}</h5>

      <div class="table-responsive">
        <table class="table table-bordered text-center align-middle calendar-table">
          <thead class="table-light">
            <tr>
              <th rowspan="2" style="width: 200px;">Водитель</th>
              <th colspan="3">Пн</th>
              <th colspan="3">Вт</th>
              <th colspan="3">Ср</th>
              <th colspan="3">Чт</th>
              <th colspan="3">Пт</th>
              <th colspan="3">Сб</th>
              <th colspan="3">Вс</th>
            </tr>
            <tr>
              {% for _ in range(7) %}
                <th>Утро</th>
                <th>День</th>
                <th>Вечер</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody class="calendarBody"></tbody>
        </table>
      </div>
    </div>
  {% endfor %}
</div>
