<h1>–î–µ—Ç–∞–ª–∏ –≤–æ–¥–∏—Ç–µ–ª—è</h1>

<!-- –ö–Ω–æ–ø–∫–∞ –ù–∞–∑–∞–¥ -->
<button type="button" class="btn btn-secondary mb-3" id="backToDriversBtn">
  ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –≤–æ–¥–∏—Ç–µ–ª–µ–π
</button>

<div class="container-fluid">
  <div class="row">
    <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
    <div class="col-md-6">
      <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
      <div class="card mb-4">
        <div class="card-header">–û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
        <div class="card-body">
          <p><strong>–ò–º—è:</strong> {{ driver.name }}</p>
          <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ driver.contact_number }}</p>
          <p><strong>–ê–¥—Ä–µ—Å:</strong> {{ driver.address }}</p>
          <p><strong>Email:</strong> {{ driver.email }}</p>
          <p><strong>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</strong> {{ driver.dob }}</p>
          <p><strong>–¢–∏–ø –≤–æ–¥–∏—Ç–µ–ª—è:</strong> {{ driver.driver_type }}</p>
          <p><strong>–°—Ç–∞—Ç—É—Å:</strong> {{ driver.status or "‚Äî" }}</p>
        </div>
      </div>

      <!-- –ü—Ä–∏–≤—è–∑–∫–∏ -->
      <div class="card mb-4">
        <div class="card-header">–ü—Ä–∏–≤—è–∑–∫–∏</div>
        <div class="card-body">
          <p><strong>–¢—Ä–∞–∫:</strong> {% if truck %}{{ truck.unit_number }} - {{ truck.make }} {{ truck.model }}{% else %}–ù–µ—Ç{% endif %}</p>
          <p><strong>–î–∏—Å–ø–µ—Ç—á–µ—Ä:</strong> {% if dispatcher %}{{ dispatcher.username }}{% else %}–ù–µ—Ç{% endif %}</p>
        </div>
      </div>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
    <div class="col-md-6">
      <!-- –õ–∏—Ü–µ–Ω–∑–∏—è -->
      <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span class="fw-bold"><i data-lucide="id-card" class="me-2"></i>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ª–∏—Ü–µ–Ω–∑–∏–∏</span>
          <button class="btn btn-sm btn-outline-primary toggle-btn" type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#collapseLicense"
                  aria-expanded="false"
                  aria-controls="collapseLicense">
            <i data-lucide="chevron-down"></i>
          </button>
        </div>
        <div id="collapseLicense" class="collapse">
          <div class="card-body">
            <p><strong>–ù–æ–º–µ—Ä:</strong> {{ driver.license.number }}</p>
            <p><strong>–ö–ª–∞—Å—Å:</strong> {{ driver.license.class }}</p>
            <p><strong>–®—Ç–∞—Ç:</strong> {{ driver.license.state }}</p>
            <p><strong>–ê–¥—Ä–µ—Å:</strong> {{ driver.license.address }}</p>
            <p><strong>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏:</strong> {{ driver.license.issued_date }}</p>
            <p><strong>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</strong> {{ driver.license.expiration_date }}</p>
            <p><strong>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:</strong> {{ driver.license.restrictions }}</p>

            {% if driver.license.file %}
              <p><strong>–§–∞–π–ª:</strong> <a href="/download_file/{{ driver._id }}/license" target="_blank">–°–∫–∞—á–∞—Ç—å</a></p>
              {% if 'pdf' in driver.license.file.content_type %}
                <iframe src="/download_file/{{ driver._id }}/license" width="100%" height="600px"
                        class="border rounded mt-3" style="display: block;"></iframe>
              {% elif 'image' in driver.license.file.content_type %}
                <img src="/download_file/{{ driver._id }}/license" alt="License Preview"
                     class="img-fluid border rounded mt-3">
              {% else %}
                <p class="text-muted">–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</p>
              {% endif %}
            {% endif %}
          </div>
        </div>
      </div>

      <!-- –ú–µ–¥–∫–∞—Ä—Ç–∞ -->
      <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span class="fw-bold"><i data-lucide="stethoscope" class="me-2"></i>–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</span>
          <button class="btn btn-sm btn-outline-primary toggle-btn" type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#collapseMed"
                  aria-expanded="false"
                  aria-controls="collapseMed">
            <i data-lucide="chevron-down"></i>
          </button>
        </div>
        <div id="collapseMed" class="collapse">
          <div class="card-body">
            <p><strong>–î–∞—Ç–∞ –≤—ã–¥–∞—á–∏:</strong> {{ driver.medical_card.issued_date }}</p>
            <p><strong>–î–∞—Ç–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è:</strong> {{ driver.medical_card.expiration_date }}</p>
            <p><strong>–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:</strong> {{ driver.medical_card.restrictions }}</p>

            {% if driver.medical_card.file %}
              <p><strong>–§–∞–π–ª:</strong> <a href="/download_file/{{ driver._id }}/medical_card" target="_blank">–°–∫–∞—á–∞—Ç—å</a></p>
              {% if 'pdf' in driver.medical_card.file.content_type %}
                <iframe src="/download_file/{{ driver._id }}/medical_card" width="100%" height="600px"
                        class="border rounded mt-3" style="display: block;"></iframe>
              {% elif 'image' in driver.medical_card.file.content_type %}
                <img src="/download_file/{{ driver._id }}/medical_card" alt="Medical Preview"
                     class="img-fluid border rounded mt-3">
              {% else %}
                <p class="text-muted">–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</p>
              {% endif %}
            {% endif %}
          </div>
        </div>
      </div>

      <!-- –î—Ä–∞–≥ —Ç–µ—Å—Ç -->
      <div class="card mb-3">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span class="fw-bold"><i data-lucide="flask-conical" class="me-2"></i>–î—Ä–∞–≥ —Ç–µ—Å—Ç</span>
          <button class="btn btn-sm btn-outline-primary toggle-btn" type="button"
                  data-bs-toggle="collapse"
                  data-bs-target="#collapseDrug"
                  aria-expanded="false"
                  aria-controls="collapseDrug">
            <i data-lucide="chevron-down"></i>
          </button>
        </div>
        <div id="collapseDrug" class="collapse">
          <div class="card-body">
            <p><strong>–î–∞—Ç–∞ —Ç–µ—Å—Ç–∞:</strong> {{ driver.drug_test.issued_date }}</p>

            {% if driver.drug_test.file %}
              <p><strong>–§–∞–π–ª:</strong> <a href="/download_file/{{ driver._id }}/drug_test" target="_blank">–°–∫–∞—á–∞—Ç—å</a></p>
              {% if 'pdf' in driver.drug_test.file.content_type %}
                <iframe src="/download_file/{{ driver._id }}/drug_test" width="100%" height="600px"
                        class="border rounded mt-3" style="display: block;"></iframe>
              {% elif 'image' in driver.drug_test.file.content_type %}
                <img src="/download_file/{{ driver._id }}/drug_test" alt="Drug Test Preview"
                     class="img-fluid border rounded mt-3">
              {% else %}
                <p class="text-muted">–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</p>
              {% endif %}
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<!-- –ö–Ω–æ–ø–∫–∞ —Å—Ö–µ–º—ã –∑–∞—Ä–ø–ª–∞—Ç—ã -->
<button type="button" class="btn btn-info mt-3" onclick="openSalaryModal()">üí∞ –°—Ö–µ–º–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã</button>



<!-- üíº –ú–æ–¥–∞–ª–∫–∞ –∑–∞—Ä–ø–ª–∞—Ç—ã -->
<div class="custom-offcanvas custom-offcanvas-right" id="salarySchemeModal">
  <div class="custom-offcanvas-content">
    <div class="custom-offcanvas-header">
      <h5 class="modal-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ö–µ–º—ã –∑–∞—Ä–ø–ª–∞—Ç—ã</h5>
      <button type="button" class="close" onclick="closeSalaryModal()">
        <span>&times;</span>
      </button>
    </div>
    <div class="custom-offcanvas-body">
      <form id="salarySchemeForm" data-driver-id="{{ driver._id }}">
        <div class="form-group">
          <label>–°—Ö–µ–º–∞ —Ä–∞—Å—á—ë—Ç–∞</label>
          <select class="form-control" name="scheme_type" id="schemeTypeSelect">
            <option value="percent" {% if scheme_data.scheme_type == 'percent' %}selected{% endif %}>–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —Å—É–º–º—ã –≥—Ä—É–∑–æ–≤</option>
            <option value="net_percent" {% if scheme_data.scheme_type == 'net_percent' %}selected{% endif %}>–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç —á–∏—Å—Ç–æ–π –ø—Ä–∏–±—ã–ª–∏</option>
            <option value="per_mile" {% if scheme_data.scheme_type == 'per_mile' %}selected{% endif %}>–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞–≤–∫–∞ –∑–∞ –º–∏–ª—é</option>
          </select>
        </div>

        <div id="percentSchemeBlock" {% if scheme_data.scheme_type != 'percent' %}style="display: none;"{% endif %}>
          <div class="form-group">
            <label>–ë–∞–∑–æ–≤—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç $0:</label>
            <input type="number" step="0.01" name="base_percent" class="form-control"
                   value="{{ scheme_data.commission_table[0].percent if scheme_data.commission_table and scheme_data.commission_table[0].from_sum == 0 else 30 }}">
          </div>
          <label>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ä–æ–≤–Ω–∏:</label>
          <div id="commissionTable">
            {% for entry in scheme_data.commission_table[1:] %}
            <div class="form-row mb-2">
              <div class="col"><input type="number" step="0.01" class="form-control" name="gross_from_sum[]" value="{{ entry.from_sum }}" placeholder="–æ—Ç —Å—É–º–º—ã ($)"></div>
              <div class="col"><input type="number" step="0.01" class="form-control" name="gross_percent[]" value="{{ entry.percent }}" placeholder="–ü—Ä–æ—Ü–µ–Ω—Ç (%)"></div>
            </div>
            {% endfor %}
          </div>
          <button type="button" class="btn btn-sm btn-outline-secondary" id="addCommissionRow">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É</button>
        </div>

        <div id="perMileBlock" {% if scheme_data.scheme_type != 'per_mile' %}style="display: none;"{% endif %}>
          <div class="form-group">
            <label>–°—Ç–∞–≤–∫–∞ –∑–∞ –º–∏–ª—é ($):</label>
            <input type="number" step="0.01" name="per_mile_rate" class="form-control"
                   value="{{ scheme_data.per_mile_rate or '' }}" placeholder="–Ω–∞–ø—Ä–∏–º–µ—Ä: 0.65">
          </div>
        </div>

        <div id="netPercentBlock" {% if scheme_data.scheme_type == 'percent' %}style="display: none;"{% endif %}>
          <div class="form-group">
            <label>–ë–∞–∑–æ–≤—ã–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç $0:</label>
            <input type="number" step="0.01" name="base_percent" class="form-control"
                   value="{{ scheme_data.net_commission_table[0].percent if scheme_data.net_commission_table and scheme_data.net_commission_table[0].from_sum == 0 else 30 }}">
          </div>
          <label>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ä–æ–≤–Ω–∏:</label>
          <div id="netCommissionTable">
            {% for entry in scheme_data.net_commission_table[1:] %}
            <div class="form-row mb-2">
              <div class="col"><input type="number" step="0.01" class="form-control" name="net_from_sum[]" value="{{ entry.from_sum }}" placeholder="–æ—Ç —Å—É–º–º—ã ($)"></div>
              <div class="col"><input type="number" step="0.01" class="form-control" name="net_percent[]" value="{{ entry.percent }}" placeholder="–ü—Ä–æ—Ü–µ–Ω—Ç (%)"></div>
            </div>
            {% endfor %}
          </div>
          <button type="button" class="btn btn-sm btn-outline-secondary" id="addNetCommissionRow">+ –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É</button>
        </div>

          <hr>
            <h5>‚ûï Additional Charges</h5>
            <div id="additionalChargesContainer">
              {% for charge in scheme_data.additional_charges %}
              <div class="border p-3 mb-3 rounded bg-light">
                <div class="form-group">
                  <label>–¢–∏–ø —Å–ø–∏—Å–∞–Ω–∏—è:</label>
                  <input type="text" name="charge_type[]" class="form-control" value="{{ charge.type }}">
                </div>

                <div class="form-group">
                  <label>–ü–µ—Ä–∏–æ–¥:</label>
                  <select name="charge_period[]" class="form-control period-select">
                    <option value="statement" {% if charge.period == 'statement' %}selected{% endif %}>–ö–∞–∂–¥—ã–π —Å—Ç–µ–π—Ç–º–µ–Ω—Ç</option>
                    <option value="monthly" {% if charge.period == 'monthly' %}selected{% endif %}>–†–∞–∑ –≤ –º–µ—Å—è—Ü</option>
                  </select>
                </div>

                <div class="form-group date-group {% if charge.period != 'monthly' %}d-none{% endif %}">
                  <label>–ß–∏—Å–ª–æ –º–µ—Å—è—Ü–∞:</label>
                  <input type="number" name="charge_day_of_month[]" class="form-control" value="{{ charge.day_of_month or '' }}">
                </div>

                <div class="form-group">
                  <label>–§–∞–π–ª:</label>
                  <input type="file" name="charge_file[]" class="form-control-file">
                  {% if charge.file %}
                  <small class="form-text text-muted">–ó–∞–≥—Ä—É–∂–µ–Ω–æ: {{ charge.file.filename }}</small>
                  {% endif %}
                </div>

                <div class="form-group">
                  <label>–°—É–º–º–∞ ($):</label>
                  <input type="number" step="0.01" name="charge_amount[]" class="form-control" value="{{ charge.amount }}">
                </div>
              </div>
              {% endfor %}
            </div>
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" id="addChargeBtn">+ –î–æ–±–∞–≤–∏—Ç—å —Å–ø–∏—Å–∞–Ω–∏–µ</button>

        <div class="mt-4 d-flex justify-content-end">
          <button type="button" class="btn btn-secondary mr-2" onclick="closeSalaryModal()">–û—Ç–º–µ–Ω–∞</button>
          <button type="submit" class="btn btn-primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ö–µ–º—É</button>
        </div>
      </form>
    </div>
  </div>
</div>
<div class="custom-offcanvas-backdrop" onclick="closeSalaryModal()"></div>
