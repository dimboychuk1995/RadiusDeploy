{% extends "base.html" %}
{% block title %}Водители{% endblock %}
{% block content %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

<h1>Водители</h1>

<!-- Панель фильтрации -->
<div class="search-bar-wrapper mb-3">
  <div class="row gx-2">
    <div class="col-md-4">
      <input type="text" id="searchNameInput" class="form-control" placeholder="Поиск по имени">
    </div>
    <div class="col-md-4">
      <input type="text" id="searchUnitNumberInput" class="form-control" placeholder="По юнит номеру">
    </div>
    <div class="col-md-4">
      <select id="searchDispatcherSelect" class="form-select">
        <option value="">Все диспетчеры</option>
        {% for dispatcher in dispatchers %}
          <option value="{{ dispatcher.username }}">{{ dispatcher.username }}</option>
        {% endfor %}
      </select>
    </div>
  </div>
</div>

<!-- Таблица -->
<table id="driversTable" class="table table-striped">
  <thead>
    <tr>
      <th>Имя</th>
      <th>Лицензия</th>
      <th>Телефон</th>
      <th>Трак</th>
      <th>Диспетчер</th>
      <th>Действия</th>
    </tr>
  </thead>
  <tbody>
    {% for driver in drivers %}
      <tr id="driver-{{ driver._id }}" data-truck-id="{{ driver.truck }}" data-dispatcher-id="{{ driver.dispatcher }}">
        <td class="driver-name">{{ driver.name }}</td>
        <td class="driver-license">{{ driver.license_number }}</td>
        <td class="driver-phone">{{ driver.contact_number }}</td>
        <td class="truck-unit">{{ driver.truck_unit or '' }}</td>
        <td class="dispatcher-name">{{ driver.dispatcher_name or '' }}</td>
        <td>
          <button onclick="openEditDriverModal('{{ driver._id }}')" class="btn btn-sm btn-primary">Редактировать</button>
          <button onclick="deleteDriver('{{ driver._id }}')" class="btn btn-sm btn-danger">Удалить</button>
        </td>
      </tr>
    {% endfor %}
  </tbody>
</table>

<!-- Кнопка и модальное окно -->
<button id="addDriverBtn" class="btn btn-success">Добавить водителя</button>

<div id="driverModal" class="modal">
  <div class="modal-content">
    <span id="driverCloseBtn" class="close">&times;</span>
    <h2 id="driverModalTitle">Добавить водителя</h2>
    <form id="driverForm" method="post" action="/drivers">
      <input type="text" name="name" placeholder="Имя" required class="form-control mb-2">
      <input type="text" name="license_number" placeholder="Лицензия" required class="form-control mb-2">
      <input type="text" name="contact_number" placeholder="Телефон" required class="form-control mb-2">

      <select name="truck" id="truckSelect" class="form-control mb-2">
        <option value="">Выберите трак</option>
        {% for truck in trucks %}
          <option value="{{ truck._id }}">{{ truck.unit_number }}</option>
        {% endfor %}
      </select>

      <select name="dispatcher" id="dispatcherSelect" class="form-control mb-2">
        <option value="">Выберите диспетчера</option>
        {% for dispatcher in dispatchers %}
          <option value="{{ dispatcher._id }}">{{ dispatcher.username }}</option>
        {% endfor %}
      </select>

      <button type="submit" id="driverSaveButton" class="btn btn-primary">Сохранить</button>
    </form>
  </div>
</div>

<!-- Скрипт -->
<script src="{{ url_for('static', filename='js/drivers.js') }}"></script>
{% endblock %}
