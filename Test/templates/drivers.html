{% extends "base.html" %}
{% block title %}Список водителей{% endblock %}

{% block content %}
<h1 class="mb-4">Список водителей</h1>

<!-- Фильтр -->
<div class="search-bar-wrapper mb-3">
  <div class="row gx-2">
    <div class="col-md-4">
      <input type="text" id="searchNameInput" class="form-control" placeholder="Поиск по имени">
    </div>
    <div class="col-md-4">
      <input type="text" id="searchUnitNumberInput" class="form-control" placeholder="По юнит номеру">
    </div>
    <div class="col-md-4">
      <select id="searchDispatcherSelect" class="form-control">
        <option value="">Все диспетчеры</option>
        {% for dispatcher in dispatchers %}
          <option value="{{ dispatcher.username }}">{{ dispatcher.username }}</option>
        {% endfor %}
      </select>
    </div>
  </div>
</div>

<!-- Таблица водителей -->
<table class="table table-striped" id="driversTable">
  <thead>
    <tr>
      <th>Имя</th>
      <th>Лицензия</th>
      <th>Телефон</th>
      <th>Трак</th>
      <th>Диспетчер</th>
      <th>Действия</</th>
    </tr>
  </thead>
  <tbody>
  {% for driver in drivers %}
  <tr id="driver-{{ driver._id }}"
      class="clickable-row"
      data-href="{{ url_for('drivers.driver_detail', driver_id=driver._id) }}"
      data-truck-id="{{ driver.truck if driver.truck else '' }}"
      data-dispatcher-id="{{ driver.dispatcher if driver.dispatcher else '' }}">
    <td class="driver-name">{{ driver.name }}</td>
    <td class="driver-license">{{ driver.license_number }}</td>
    <td class="driver-phone">{{ driver.contact_number }}</td>
    <td class="truck-unit">{{ driver.truck_unit or '' }}</td>
    <td class="dispatcher-name">{{ driver.dispatcher_name or '' }}</td>
    <td>
      <button class="btn btn-sm btn-primary" onclick="event.stopPropagation(); openEditDriverModal('{{ driver._id }}')">Редактировать</button>
      <button class="btn btn-sm btn-danger" onclick="event.stopPropagation(); deleteDriver('{{ driver._id }}')">Удалить</button>
    </td>
  </tr>
  {% endfor %}
</tbody>
</table>

<!-- Кнопка -->
<button id="addDriverBtn" class="btn btn-success mb-3">Добавить водителя</button>

<!-- Модальное окно -->
<div id="driverModal" class="modal">
  <div class="modal-content p-4">
    <span id="driverCloseBtn" class="close">&times;</span>
    <h4 id="driverModalTitle" class="mb-3">Добавить водителя</h4>

    <form id="driverForm" method="post" action="/drivers">
      <h5 class="mb-3">Личные данные</h5>

      <div class="mb-2">
        <label for="name">Имя:</label>
        <input type="text" name="name" id="name" class="form-control" placeholder="Введите имя водителя" required>
      </div>

      <div class="mb-2">
        <label for="license_number">Номер лицензии:</label>
        <input type="text" name="license_number" id="license_number" class="form-control" placeholder="Номер CDL / DL" required>
      </div>

      <div class="mb-3">
        <label for="contact_number">Контактный телефон:</label>
        <input type="text" name="contact_number" id="contact_number" class="form-control" placeholder="+1 (___) ___-____" required>
      </div>

      <h5 class="mb-3">Назначение</h5>

      <div class="mb-2">
        <label for="truckSelect">Привязанный трак:</label>
        <select name="truck" id="truckSelect" class="form-control">
          <option value="">Выберите трак</option>
          {% for truck in trucks %}
          <option value="{{ truck._id }}">{{ truck.unit_number }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="mb-3">
        <label for="dispatcherSelect">Закреплённый диспетчер:</label>
        <select name="dispatcher" id="dispatcherSelect" class="form-control">
          <option value="">Выберите диспетчера</option>
          {% for dispatcher in dispatchers %}
          <option value="{{ dispatcher._id }}">{{ dispatcher.username }}</option>
          {% endfor %}
        </select>
      </div>

      <button type="submit" id="driverSaveButton" class="btn btn-primary w-100">Сохранить</button>
    </form>
  </div>
</div>

<!-- Подключение JS -->
<script src="{{ url_for('static', filename='js/drivers.js') }}"></script>
{% endblock %}